name: "$(SourceBranchName)+$(BuildID)"

trigger:
  branches:
    include:
      - tags/refs/v*
  tags:
    include:
      - v*

pr:
  branches:
    include: ['*']

resources:
  repositories:
    - repository: s3-cache-action
      type: github
      name: NHSDigital/apim-s3-cache-action
      ref: refs/heads/apm-1741-pipelines-integration-poc
      endpoint: NHSDigital

pool:
  vmImage: "ubuntu-18.04"

stages:
  - stage: simulate_deploy
    jobs:
    - job: checkout_repos
      steps:
        - checkout: self

        - checkout: s3-cache-action

        - bash: |
            echo Route
            ls
            echo Canary
            cd canary-api
            ls
            cd ..
            echo S3
            cd apim-s3-cache-action
            ls

        - task: d09d4fd3-510d-4126-baf3-7391216cd336@0.0.1
          displayName: 'Use custom s3 cache task'
          inputs:
            samplestring: test file
